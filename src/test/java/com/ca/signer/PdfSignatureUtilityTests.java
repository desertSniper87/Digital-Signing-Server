package com.ca.signer;

import java.io.IOException;
import java.security.GeneralSecurityException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Base64;
import java.util.List;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import com.ca.signer.model.PdfDocument;
import com.ca.signer.pdf.PdfSignatureHandler;
import com.ca.signer.utils.CertificateUtils;

@RunWith(SpringRunner.class)
@SpringBootTest
public class PdfSignatureUtilityTests {

	PdfDocument doc = new PdfDocument();

	@Test
	public void contextLoads() {
	}

	public void testHash() throws Exception {
		doc.setName("D:/temp/test1.pdf");
		doc.setPath("D:/temp/SamplePCC_empty_signed.pdf");
		// server
		PdfSignatureHandler.emptySignature(PdfSignatureHandler.getCertChains(), doc);
		PdfSignatureHandler.makeHash(PdfSignatureHandler.getCertChains(), doc);
	}

	public void testSign() throws Exception {
		byte[] hash = Base64.getDecoder().decode(doc.getDigest());

		System.out.println("hash: " + Arrays.toString(hash));

		byte[] signedEncoded = PdfSignatureHandler.signHash(hash);
		String base64EncodedSignedEncodedHash = Base64.getEncoder().encodeToString(signedEncoded);
		System.out.println(base64EncodedSignedEncodedHash);

		doc.setSignedEncoded(base64EncodedSignedEncodedHash);
	}

	@Test
	public void testCert() throws Exception {
		List<String> list = new ArrayList<String>();
		String test = "308205AE30820496A0030201020210670BC9094DB15C0E1217C42D7AABD4F9300D06092A864886F70D01010B05003075312F302D06035504031326424343205375622D434120666F7220436C6173732032204365727469666963617465732D4732310F300D060355040B13065375622D434131243022060355040A131B42616E676C616465736820436F6D707574657220436F756E63696C310B3009060355040613024244301E170D3231303731303030303030305A170D3232303731303233353935395A3081B1310B300906035504061302424431243022060355040A141B42616E676C616465736820436F6D707574657220436F756E63696C310B3009060355040B14024341310D300B0603550411140431323037310E300C060355040714054468616B61313430320603550405132B4E494431323632623266376265363361646461626635326132623833373139666339373463363434396666311A3018060355040313114D6420536861726966756C2049736C616D30820122300D06092A864886F70D01010105000382010F003082010A0282010100913E1879409B5491A8D260C5C6D7BAF79BB46AF2A723679573D25BA87C29364BE45C9DDE8D0B04C7479CCD9F554A37D0F95E8476D5F3B35A4FC7D5C006DBE11E5844884C1F7C759D49E7B75DDA3F6D63731BA3C6854CE1D5B95047525A03977EFA19B06B6CB722541C95B1515F93764754E514514C09A08959BE8DF78DDE808E423AD0388DC89C091CB6EFAB710C888A31A87239CD09CFE502BBCC56AA89FEFFF0FBC57E780D2B3D5B29696601FF5254D1863F30F15EB76CAFF7C8815BA13013494F57E904F8DBA22B21139748C93036302E375ACB5EE60676A445345CB85BA94F4CE36F307F3E7D20DA75AFB1ED7AACA9B03880DB1D5FB8D4FB61B6B8C83C030203010001A38201FB308201F7300C0603551D130101FF04023000305C0603551D1F045530533051A04FA04D864B687474703A2F2F63726C2E6263632D63612E676F762E62642F42434343414D656469756D47324F7267616E697A6174696F6E616C53534C436C69656E742F4C617465737443524C2E63726C300E0603551D0F0101FF0404030205A030160603551D250101FF040C300A06082B06010505070302301D0603551D0E04160414B83E96B0D8306E881D3BD3E16E98AE8B2BCDFE74301F0603551D23041830168014DD240E0AC9CA7312A2A0E22355F1F2A4D6DCD11130818C0603551D20048184308181307F060560320102023076303306082B060105050702011627687474703A2F2F7265706F2E6263632D63612E676F762E62642F646F63756D656E74732F435053303F06082B0601050507020230331A31436572746966696361746573206964656E74696669656420746F204D656469756D204173737572616E6365204C6576656C307F06082B0601050507010104733071302506082B060105050730018619687474703A2F2F6F6373702E6263632D63612E676F762E6264304806082B06010505073002863C22687474703A2F2F7265706F2E6263632D63612E676F762E62642F63657274732F42434343412D5375622D43412D47322D436C617373322E63657222301106096086480186F8420101040403020780300D06092A864886F70D01010B0500038201010079A2292C2A0786BE0B4FB6ECB12389D6CB87E6F8A513BF08BE899B35FAF2FB9052922A3346D8BA2DCB42370C8BFAF34F15A0A8A0B8ECF6926A6163DA40FDDDBDCED5A1D8276E1688A4492C1A755C09C1B0D8068299CE476520D8C2231D79A438B0400CAC8A728EF464D1E65C45190B0985346DE9A048BBE2E84CA5F5E5DB5FD2133908E8E379E5AB5059A9FBCAB41832D23909E50C89B1BBC2FF6E4083B06943187E9ACB88441495DF8501B2453031A32FCDEC198BB2568B770B7C3C6153C4078D62F83E873B621972FA29B1EFFC640AC6B4A3A37D77CFC19463DCDF40365524C29B82C6837594661A477E98D74671CAF95A4524CFCE8E20920127BD7A4FE728";
		list.add(test);

		CertificateUtils.getCertListFromHexStrList(list);
	}

}
